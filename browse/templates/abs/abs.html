{%- extends "base/base.html" %}

{#- build breadcrumb items as link : label pairs, excluding home and current page -#}
{% set breadcrumb = {
  url_for('.list_articles',context=abs_meta.primary_archive.id, subcontext='recent') : abs_meta.primary_archive.id,
} %}

{% from 'abs/author_links.html' import display_authors_with_links %}

{% import 'base/macros.html' as base_macros %}

{% block pagetitle %}arxiv:{{ requested_id }}{% endblock %}

{% block addl_head %}
  {{ super() -}}
  {%- if config['LABS_ENABLED'] and config['LABS_BIBEXPLORER_ENABLED'] -%}
  <link rel="stylesheet" media="screen" type="text/css" href="https://static.arxiv.org/js/bibex-dev/bibex.css?20200709"/>
  {%- endif %}
  <script src="{{ url_for('static', filename='js/mathjaxToggle.min.js') }}" type="text/javascript"></script>
  {%- if config['LABS_ENABLED'] -%}
  {#  <link rel="stylesheet" type="text/css" media="screen" href="{{ url_for('static', filename='css/paperwithcode.css') }}" /> #}
  <script src="//cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js" type="text/javascript"></script>
  <script src="{{ url_for('static', filename='js/toggle-labs.js') }}?20210223" type="text/javascript"></script>
  <script src="{{ url_for('static', filename='js/cite.js') }}" type="text/javascript"></script>
  {%- endif %}
  {%- include "feedback_collector_js.html" -%}
  {{- generate_scholar_tags() }}
  {{- generate_social_media_tags() }}
{% endblock addl_head %}

{%- block content %}

{% set download_button %}
  {{ generate_download_button('d-md-none') }}
{% endset %}

{% block breadcrumbs %}
{% endblock breadcrumbs %}

<div class="row">
  <div class="col-md">
    {% if is_covid_match %}
    <div class="alert alert-primary" role="alert">
      <h4 class="alert-heading">COVID-19 e-print</h4>
      <p><em>Important:</em> e-prints posted on arXiv are not peer-reviewed by arXiv; they should not be relied upon without context to guide clinical practice or health-related behavior and should not be reported in news media as established information without consulting multiple experts in the field.</p>
    </div>
    {% endif -%}

    <strong>arXiv:{{ requested_id }}</strong> ({{ abs_meta.primary_archive.id }}, {{ abs_meta.primary_archive.name }})
    {{
      base_macros.abs(
      abs_meta.arxiv_identifier.id,
      abs_meta.title,
      display_authors_with_links(abs_meta, author_links),
      abs_meta.abstract,
      abs_meta.get_datetime_of_version(abs_meta.version),
      abs_meta.primary_category.id,
      comments = abs_meta.comments,
      msc_class = abs_meta.msc_class,
      acm_class = abs_meta.acm_class,
      journal_ref = abs_meta.journal_ref,
      doi = abs_meta.doi,
      report_num = abs_meta.report_num,
      version = abs_meta.version,
      submission_history = abs_meta.version_history,
      secondary_categories = abs_meta.get_secondaries(),
      download_button_markup = download_button )
    }}
  </div>
  <div class="col-md col-md-3 border-start">
    {% include "abs/sidebar.html" %}
    {%- include "abs/trackback_rdf.html" %}
    <!-- <a id="mathjax_toggle" href="javascript:setMathjaxCookie()">Disable MathJax</a> (<a href="{{ url_for('help_mathjax') }}">What is MathJax?</a> -->
    <script type="text/javascript" language="javascript">mathjaxToggle();</script>
  </div>
</div><!-- /end row -->
{% endblock content %}





{% block content_extra %}
<div class="arxiv-labs">
  {% include "abs/labs_tabs.html" %}
</div>
{% endblock content_extra %}





{%- macro generate_version_entry(version_entry, this_version) %}
  {%- if version_entry.version == this_version -%}
  <strong>[v{{ version_entry.version }}]</strong>
{% else %}
  <strong><a href="{{ url_for('.abstract', arxiv_id='{}v{}'.format(abs_meta.arxiv_id, version_entry.version)) }}">[v{{ version_entry.version }}]</a></strong>
  {% endif %}{{ version_entry.submitted_date.strftime('%a, %-d %b %Y %H:%M:%S %Z') }} ({{ "{:,}".format(version_entry.size_kilobytes) }} KB){#- ({{(version_entry.size_kilobytes*1000)|filesizeformat}}) -#}<br/>
{%- endmacro -%}

{%- macro generate_dateline() -%}
  [Submitted on {{ abs_meta.version_history[0].submitted_date.strftime('%-d %b %Y') }}
  {%- if abs_meta.version == 1 and abs_meta.version < abs_meta.version_history[-1].version %} (this version){%- endif -%}
  {%- if abs_meta.version != 1 %} (<a href="{{ url_for('.abstract', arxiv_id='{}v1'.format(abs_meta.arxiv_id)) }}">v1</a>){%- endif %}
  {%- if abs_meta.version > 1 and abs_meta.version < abs_meta.version_history[-1].version -%}
  , revised {{ abs_meta.version_history[abs_meta.version-1].submitted_date.strftime('%-d %b %Y') }} (this version, v{{ abs_meta.version }})
  {%- endif -%}
  {%- if abs_meta.version != abs_meta.version_history[-1].version -%}
  , <em>latest version {{ abs_meta.version_history[-1].submitted_date.strftime('%-d %b %Y') }}</em> (<a href="{{ url_for('.abstract', arxiv_id='{}v{}'.format(abs_meta.arxiv_id, abs_meta.version_history[-1].version)) }}">v{{ abs_meta.version_history[-1].version }}</a>)
  {%- elif abs_meta.version > 1 and abs_meta.version == abs_meta.version_history[-1].version -%}
  , last revised {{ abs_meta.version_history[-1].submitted_date.strftime('%-d %b %Y') }} (this version, v{{ abs_meta.version }})
  {%- endif -%}
  ]
{%- endmacro -%}

{%- macro generate_scholar_tags() -%}
{%- if meta_tags %}
    {%- for tag in meta_tags %}
  <meta name="{{tag.name}}" content="{{tag.content}}"/>
    {%- endfor -%}
{%- endif -%}
{%- endmacro -%}

{%- macro generate_social_media_tags() -%}
    <meta name="twitter:site" content="@arxiv"/>
    <meta property="twitter:title" content="{{ abs_meta.title|tex2utf|truncate(70, False, '...') }}"/>
    <meta property="twitter:description" content="{{ abs_meta.abstract|trim|truncate(200, False, '...')|tex2utf }}"/>
    <meta property="og:site_name" content="arXiv.org"/>
    <meta property="og:title" content="{{ abs_meta.title|tex2utf }}"/>
    <meta property="og:url" content="{{ canonical_url(abs_meta.arxiv_id, abs_meta.version) }}"/>
    <meta property="og:description" content="{{ abs_meta.abstract|trim|tex2utf }}"/>
{%- endmacro -%}

{%- macro category_line() -%}
  <span class="primary-subject">{{- abs_meta.primary_category.unalias().display -}}</span>
  {%- if abs_meta.secondary_categories -%}
    {%- for category in abs_meta.display_secondaries() -%}
        ; {{ category }}
    {%- endfor -%}
  {%- endif -%}
{%- endmacro -%}

{%- macro version_atag(arxiv_id, version, primary_category) -%}
  {%- if version -%}
    {%- set vpart = 'v' ~ version -%}
  {%- else -%}
    {%- set vpart = '' -%}
  {% endif %}
  {%- if primary_category in arxiv_id -%}
    <a href="{{ arxiv_id|canonical_url(version) }}">arXiv:{{ abs_meta.arxiv_id }}{{vpart}}</a>
    {%- else -%}
    <a href="{{ arxiv_id|canonical_url(version) }}">arXiv:{{ abs_meta.arxiv_id }}{{vpart}}</a> [{{ abs_meta.primary_category }}]
  {%- endif -%}
{%- endmacro -%}

{% macro generate_download_button(display) %}
  {#- to display only on mobile use this display class: d-sm-none -#}
  {% if formats|length > 0 and ('pdf' in formats or 'pdfonly' in formats) %}
    <a class="btn btn-primary {{ display }}" href="{{url_for('.pdf', arxiv_id=requested_id)}}">Download PDF</a>
  {% else %}
    <a class="btn disabled d-sm-none" href="#other">No PDF available, click to view other formats</a>
  {% endif %}
{% endmacro %}
